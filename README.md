# 用户中心 - dawn

---

## 需求分析

---

1. 登录 / 注册
2. 用户管理 （管理员拥有最高权限 / 用户只可以修改自身信息）

## 技术选型

---

后端 ： go + gorilla + mysql + docker

部署： 服务器 / 容器（平台）

## 项目初始化

---

mysql使用docker 部署

自定义错误码

自定义返回码

跨域

## 用户模块

---

### 库表设计

库名：dawn

表名： users （用户表）

---

### 注册功能

#### 接口设计

接受参数 ： 用户账户、密码、校验码

请求类型： POST

返回值： 用户id

#### 逻辑

1. 校验用户的账户、密码、校验码是否合法
   1. 非空
   2. 账户长度不小于4位
   3. 密码、校验码长度不小于8位
   4. 账户不包含特殊字符
   5. 密码和校验码是否相同
   6. 用户是否存在
2. 对密码进行加密
3. 向数据库插入用户数据

---

### 登录功能

#### 接口设计

接受参数 ： 用户账户、密码

请求类型 ： POST

返回值： 用户信息（脱敏）

#### 逻辑：

1. 校验用户账户密码是否合法
   1. 非空
   2. 账户长度不小于4位
   3. 密码长度不小于8位
   4. 账户不包含特殊字符
   5. 校验用户是否存在 
      1. 若存在， 校验密码是否输入正确
   6. 用户信息托敏
   7. 记录用户登录态（session）
2. 返回脱敏后信息

---

### 获取当前登录用户

#### 接口设计

请求类型： GET

返回值： 用户信息（脱敏）

#### 逻辑：

1. 校验用户是否登录
2. 从session中取出用户数据
3. 返回脱敏后用户信息

---

### 用户注销

#### 接口设计

请求类型： POST

#### 逻辑：

1. 校验用户是否登录
2. 移除用户登录态

---

### 用户更新

#### 接口设计

接受参数： id、用户密码、用户昵称、用户头像、用户简介

请求类型： POST

返回值： 用户信息（脱敏）

#### 逻辑：

1. 校验更新id与登录信息是否一致 （不一致 => 无权限）
2. 检查密码是否符合要求（若有输入更新密码要求）
3. 将更新的数据插入数据库对应用户
4. 返回脱敏后的用户信息

---

### 用户权限控制

使用中间件，在/admin前缀的路由下使用

---

### 用户管理（管理员）

用户管理功能：

+ 创建用户
+ 更新用户
+ 根据id获取用户（未脱敏）
+ 分页获取用户（需要脱敏）
+ 根据id删除用户
